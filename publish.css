/* 1. БАЗОВЫЕ ПЕРЕМЕННЫЕ (Универсальные) */
:root {
    --p-accent: #0679a7;
    --p-bg: #ffffff;
    --p-text: #000000;
    --p-muted: #747474;
}

/* 2. ЛОГИКА ДЛЯ ТЕМНОЙ ТЕМЫ (Браузер + Системная тема) */
@media (prefers-color-scheme: dark) {
    :root {
        --p-bg: #1e1e1e !important;   
        --p-text: #e0e0e0 !important; 
        --p-muted: #a0a0a0 !important;
    }
}

/* 3. ЛОГИКА ДЛЯ ОБСИДИАНА (Светлая и Темная темы) */
.theme-dark {
    --p-bg: var(--background-primary) !important;
    --p-text: var(--text-normal) !important;
    --p-muted: var(--text-muted) !important;
}
.theme-light {
    --p-bg: var(--background-primary) !important;
    --p-text: var(--text-normal) !important;
    --p-muted: var(--text-muted) !important;
}

/* 4. ОСНОВНОЙ КОНТЕЙНЕР (Геометрия сохранена) */
.callout[data-callout="problem"] {
    border: 2px solid var(--p-accent) !important; 
    background-color: var(--p-bg) !important;
    color: var(--p-text) !important;
    border-radius: 6px !important;
    margin: 15px 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
}

/* 5. ШАПКА */
.callout[data-callout="problem"] > .callout-title {
    background-color: var(--p-accent) !important; 
    padding: 8px 15px !important;
    color: #ffffff !important; 
    font-weight: bold !important;
}

.callout[data-callout="problem"] > .callout-title .callout-icon {
    display: none !important;
}

/* 6. ТЕЛО ЗАДАЧИ */
.callout[data-callout="problem"] > .callout-content {
    padding: 15px 15px 5px 15px !important;  
    background-color: var(--p-bg) !important;
    color: var(--p-text) !important;
}

/* 7. БЛОК ОТВЕТА */
.callout[data-callout="problem"] .callout[data-callout="answer"] {
    border: none !important;
    border-top: 1px solid var(--p-accent) !important; 
    background-color: transparent !important;
    margin-top: 15px !important; 
    margin-left: -15px !important;
    margin-right: -15px !important;
    padding: 8px 15px 5px 15px !important; 
}

.callout[data-callout="problem"] .callout[data-callout="answer"] > .callout-title {
    background-color: transparent !important;
    color: var(--p-muted) !important; 
    font-size: 0.95em !important;
    padding: 0 !important;
}

.callout[data-callout="problem"] .callout[data-callout="answer"] > .callout-content {
    color: var(--p-text) !important;
}

.callout[data-callout="problem"] .callout[data-callout="answer"] .callout-fold-icon {
    color: var(--p-accent) !important; 
}

/* 8. РАЗМЕТКА КОЛОНОК */
.task-layout {
    display: flex !important;
    flex-direction: row !important;
    gap: 20px !important;
    align-items: flex-start !important;
}

.task-text { flex: 1 !important; }

.task-image {
    flex: 0 0 auto !important;
    max-width: 250px !important;
}

/* Инверсия картинки для темной темы (чтобы не было белого пятна) */
@media (prefers-color-scheme: dark) {
    .task-image img {
        filter: invert(0.9) hue-rotate(180deg); /* Инвертирует белый фон картинки в темный */
    }
}