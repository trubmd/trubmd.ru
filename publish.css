/* 1. ОПРЕДЕЛЕНИЕ ЦВЕТОВ (ЕДИНСТВЕННОЕ ИЗМЕНЕНИЕ ЛОГИКИ) */
:root {
    --task-bg: #ffffff;
    --task-text: #000000;
}

@media (prefers-color-scheme: dark) {
    :root {
        --task-bg: #1e1e1e; /* Цвет фона страницы в темной теме браузера */
        --task-text: #e0e0e0;
    }
}

/* Синхронизация с темами самого Obsidian */
.theme-dark {
    --task-bg: var(--background-primary);
    --task-text: var(--text-normal);
}
.theme-light {
    --task-bg: #ffffff;
    --task-text: #000000;
}

/* 2. ПРИНУДИТЕЛЬНЫЙ ФОН СТРАНИЦЫ (Для браузера) */
@media (prefers-color-scheme: dark) {
    body, 
    .markdown-rendered, 
    .markdown-preview-view {
        background-color: var(--task-bg) !important;
        color: var(--task-text) !important;
    }
}

/* 3. ОСНОВНОЙ КОНТЕЙНЕР ЗАДАЧИ (ГЕОМЕТРИЯ НЕ ТРОНУТА) */
.callout[data-callout="problem"] {
    --callout-color: 6, 121, 167; 
    border: 2px solid #0679a7 !important; 
    
    background-color: var(--task-bg) !important; /* Изменено с transparent на переменную */
    
    border-radius: 6px !important;
    margin: 15px 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
    padding-bottom: 0px !important;
}

/* 4. ШАПКА ЗАДАЧИ */
.callout[data-callout="problem"] > .callout-title {
    background-color: #0679a7 !important; 
    padding: 8px 15px !important;
    color: #ffffff !important; 
    font-weight: bold !important;
}

.callout[data-callout="problem"] > .callout-title .callout-icon {
    display: none !important;
}

/* 5. ТЕЛО ЗАДАЧИ */
.callout[data-callout="problem"] > .callout-content {
    padding: 15px 15px 5px 15px !important;  
    background-color: var(--task-bg) !important; /* Изменено */
    color: var(--task-text) !important;         /* Изменено */
}

/* 6. БЛОК ОТВЕТА ВНУТРИ */
.callout[data-callout="problem"] .callout[data-callout="answer"] {
    border: none !important;
    border-top: 1px solid #0679a7 !important; 
    background-color: var(--task-bg) !important; /* Изменено */
    margin-top: 15px !important; 
    margin-left: -15px !important;
    margin-right: -15px !important;
    padding: 8px 15px 5px 15px !important; 
    border-radius: 0 !important;
    margin-bottom: 0px !important;
}

/* Заголовок "Ответ" */
.callout[data-callout="problem"] .callout[data-callout="answer"] > .callout-title {
    background-color: transparent !important;
    font-style: normal !important; 
    font-weight: normal !important; 
    font-size: 0.95em !important;
    padding: 0 !important;
    color: gray !important; 
    min-height: 0 !important;
}

/* Текст ответа */
.callout[data-callout="problem"] .callout[data-callout="answer"] > .callout-content {
    font-style: normal !important; 
    padding: 2px 0 2px 0 !important;
    margin: 0 !important;
    color: var(--task-text) !important; /* Изменено */
}

/* 7. ГЕОМЕТРИЯ КОЛОНОК (БЕЗ ИЗМЕНЕНИЙ) */
.task-layout {
    display: flex !important;
    flex-direction: row !important;
    gap: 20px !important;
    align-items: flex-start !important;
}
.task-text { flex: 1 !important; }
.task-image {
    flex: 0 0 auto !important;
    max-width: 250px !important;
    text-align: right !important;
}

/* 8. АДАПТАЦИЯ КАРТИНОК И ФОРМУЛ */
@media (prefers-color-scheme: dark) {
    img, .task-image img {
        filter: invert(0.9) hue-rotate(180deg) brightness(1.1) !important;
        background-color: transparent !important;
    }
}

/* =========================================================
   WEB HTML EXPORTER — АДАПТАЦИЯ ПОД ТЁМНУЮ ТЕМУ БРАУЗЕРА
   ========================================================= */

@media (prefers-color-scheme: dark) {

    /* Фон страницы экспорта */
    html:not(.theme-light):not(.theme-dark) body,
    html:not(.theme-light):not(.theme-dark) .markdown-preview-view,
    html:not(.theme-light):not(.theme-dark) .markdown-rendered {
        background-color: #121212 !important;
        color: #e6e6e6 !important;
    }

}



/* =========================================================
   ДОПОЛНЕНИЕ: МОДИФИКАТОР ДЛЯ РАСПОЛОЖЕНИЯ КАРТИНКИ СНИЗУ
   Используйте <div class="task-layout vertical">
   ========================================================= */

/* Если добавлен класс .vertical, меняем направление на колонку */
.task-layout.vertical {
    flex-direction: column !important;
    gap: 15px !important;
    align-items: center !important; /* Центрируем картинку */
}

/* Растягиваем текст на всю ширину */
.task-layout.vertical .task-text {
    width: 100% !important;
    flex: none !important;
}

/* Убираем ограничения ширины для картинки в вертикальном режиме */
.task-layout.vertical .task-image {
    width: 100% !important;
    max-width: 100% !important;
    text-align: center !important;
    margin: 0 auto !important;
}

/* Обеспечиваем корректный масштаб картинки */
.task-layout.vertical .task-image img {
    max-width: 100% !important;
    height: auto !important;
    margin: 0 auto !important;
}


/* =========================================================
   ИСКЛЮЧЕНИЕ ИНВЕРСИИ ДЛЯ МОЕГО ФОТО
   ========================================================= */

@media (prefers-color-scheme: dark) {
    /* Если в названии файла есть 'trubmd', мы отменяем фильтр */
    img[src*="trubmd"], 
    img[alt*="trubmd"] {
        filter: none !important;
        -webkit-filter: none !important;
    }
}

